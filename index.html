<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino Lobby - Refined</title>
    <style>
        /* --- ÂÖ®Â±ÄË®≠ÂÆö --- */
        :root {
            --text-gold: #f4d06f;
            --text-white: #ffffff;
            --panel-bg: rgba(25, 28, 40, 0.65); 
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        /* 1. Body Ë®≠ÂÆö */
        body {
            background-color: #000;
            width: 100vw; height: 100vh; overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
            display: flex; justify-content: center; align-items: center;
            background: radial-gradient(circle at center, #333333 0%, #000000 85%);
        }

        /* 2. App ÂÆπÂô® */
        .app-container {
            height: 100%; aspect-ratio: 9/16; max-width: 100vw; 
            position: relative; display: flex; flex-direction: column;
            background-color: #121212; background-image: url('bg.png');
            background-size: 100% 100%; background-repeat: no-repeat;
            box-shadow: 0 0 50px rgba(0,0,0,0.8); z-index: 1; overflow: hidden;
        }

        #lobby-bg-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; mix-blend-mode: screen; }

        .gradient-border-box::after {
            content: ""; position: absolute; inset: 0; border-radius: inherit; padding: 1.5px; 
            background: linear-gradient(90deg, rgba(170, 135, 65, 0) 0%, #aa8741 25%, #cbbd83 50%, #aa8741 75%, rgba(170, 135, 65, 0) 100%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor; mask-composite: exclude;
            pointer-events: none; z-index: 10; 
        }

        /* --- UI Bars --- */
        .top-bar {
            position: absolute; top: 0; left: 0; height: 10%; width: 100%; padding: 0 2%;
            display: flex; align-items: center; justify-content: space-between; z-index: 200;
            background: rgba(20, 22, 35, 0.7); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 0 0 4vh 4vh;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5), inset 0 0 25px rgba(255, 220, 150, 0.15);
        }
        .top-bar.gradient-border-box::after { top: -4px; height: calc(100% + 2px); }

        .user-section { display: flex; align-items: center; gap: 6px; width: auto; flex-shrink: 0; margin-right: 5px; }
        .avatar-img { height: 5.5vh; width: 5.5vh; border-radius: 50%; object-fit: cover; border: 2px solid #333; }
        .vip-text { color: var(--text-gold); font-weight: 800; font-size: 1.8vh; letter-spacing: 0.5px; }
        
        .coin-bar { 
            flex: 1; height: 55%; 
            display: flex; align-items: center; justify-content: space-between; 
            background: rgba(0, 0, 0, 0.2); 
            border: 2px solid rgba(255, 215, 0, 0.3); 
            border-radius: 50px; 
            padding: 0 8px 0 6px; 
            min-width: 0; 
        }
        .gold-icon { height: 63%; width: auto; flex-shrink: 0; }
        
        .center-group { 
            flex: 1; display: flex; align-items: center; 
            justify-content: flex-end; 
            min-width: 0; padding-right: 0; overflow: hidden; 
        }
        
        .coin-number { 
            color: var(--text-white); 
            font-weight: 650; 
            font-size: 3.5vh; 
            margin-right: 8px; margin-top: -4px; 
            letter-spacing: -0.5px; white-space: nowrap; 
            overflow: hidden; text-overflow: ellipsis; line-height: 1.1; 
        }
        
        .coins-text-img { 
            height: 1.8vh; 
            width: auto; margin-top: 3px; opacity: 1.0; flex-shrink: 0; 
        } 
        
        .clickable-btn { transition: transform 0.1s ease; }
        .clickable-btn:active { transform: scale(0.85); filter: brightness(1.2); }
        .plus-btn { display: none; }
        .menu-btn { height: 28%; width: auto; cursor: pointer; margin-left: 8px; flex-shrink: 0;}

        /* --- Ghost Ticker --- */
        #ghost-ticker {
            position: absolute; top: 11%; left: 50%; transform: translateX(-50%);
            width: 90%; height: 3.5vh;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; pointer-events: none; z-index: 190;
            opacity: 0; transition: opacity 0.5s ease;
        }
        #ghost-ticker.active { opacity: 1; }
        .ticker-content {
            white-space: nowrap; color: #ffffff; font-weight: normal; font-size: 2.0vh;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.9);
        }
        @keyframes scrollText {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-150%); }
        }

        /* --- Â∫ïÈÉ®Â∞éËà™ --- */
        .bottom-nav {
            position: absolute; bottom: 2.5vh; left: 3%; width: 94%; height: 11.7%;
            display: flex; justify-content: space-around; align-items: center; z-index: 200;
            background: rgba(20, 22, 35, 0.65); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-radius: 4vh; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 0 25px rgba(255, 220, 150, 0.15);
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0; cursor: pointer; width: 20%; height: 100%; transition: transform 0.1s; }
        .nav-item:active { transform: scale(0.9); }
        .nav-icon { height: 75%; width: auto; object-fit: contain; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3)); transform: scale(0.85) translateY(2px); transition: transform 0.2s; }
        .nav-label { font-size: 1.6vh; font-weight: 700; color: #aaa; letter-spacing: 0.5px; margin-top: -8px; z-index: 2; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
        .nav-item.active .nav-icon { animation: breathe 2.5s ease-in-out infinite; }
        .nav-item.active .nav-label { color: #fff; text-shadow: 0 0 8px rgba(255, 255, 255, 0.8); }
        @keyframes breathe {
            0% { transform: scale(1.1) translateY(2px); filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.4)); }
            50% { transform: scale(1.15) translateY(2px); filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.8)); }
            100% { transform: scale(1.1) translateY(2px); filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.4)); }
        }

        /* --- ‰∏ªÈÅäÊà≤ÂàóË°® --- */
        .main-scroll-area {
            flex: 1; overflow-y: auto; overflow-x: hidden;
            padding-top: calc(10% + 50px); padding-bottom: 18%; 
            display: flex; flex-direction: column; gap: 10px; 
            position: relative; z-index: 5; 
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .main-scroll-area::-webkit-scrollbar { display: none; }
        .main-scroll-area.hidden .game-card:nth-child(odd) { transform: translateX(-120%); opacity: 0; }
        .main-scroll-area.hidden .game-card:nth-child(even) { transform: translateX(120%); opacity: 0; }
        .game-card { width: 80.6%; aspect-ratio: 2/1; margin: 0 auto; position: relative; border-radius: 26px; overflow: hidden; box-shadow: none !important; border: none !important; background: transparent; flex-shrink: 0; opacity: 0; animation: slideIn 0.5s ease-out forwards; cursor: pointer; transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.3s ease; }
        .game-card::after { content: ""; position: absolute; top: 0; left: 0; width: 200%; height: 100%; background: linear-gradient(120deg, rgba(255, 255, 255, 0) 30%, rgba(255, 255, 255, 0.4) 50%, rgba(255, 215, 0, 0.2) 55%, rgba(255, 255, 255, 0) 70%); transform: translateX(-150%) skewX(-25deg); pointer-events: none; mix-blend-mode: overlay; animation: shimmer 5s infinite; }
        .game-card:nth-child(odd)::after { animation-delay: 0s; } .game-card:nth-child(even)::after { animation-delay: 2.5s; }
        .game-img { width: 100%; height: 100%; object-fit: cover; display: block; }
        @keyframes launchSequence { 0% { transform: scale(1); filter: brightness(1); opacity: 1; } 40% { transform: scale(0.95); filter: brightness(1.3) contrast(1.1) drop-shadow(0 0 30px rgba(255, 215, 0, 0.8)); opacity: 1; } 100% { transform: scale(1.15); filter: brightness(1.5) drop-shadow(0 0 60px rgba(255, 215, 0, 0)); opacity: 0; } }
        .game-card.launching { opacity: 1 !important; animation: launchSequence 0.5s ease-in-out forwards; z-index: 999; pointer-events: none; }
        .game-card.launching::after { opacity: 0; transition: opacity 0.1s; }
        @keyframes slideIn { 0% { opacity: 0; transform: translateY(80px); } 70% { opacity: 1; transform: translateY(-5px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes shimmer { 0% { transform: translateX(-150%) skewX(-25deg); } 60% { transform: translateX(150%) skewX(-25deg); } 100% { transform: translateX(150%) skewX(-25deg); } }
        .game-card:nth-child(1) { animation-delay: 0.1s; } .game-card:nth-child(2) { animation-delay: 0.2s; } .game-card:nth-child(3) { animation-delay: 0.3s; } .game-card:nth-child(4) { animation-delay: 0.4s; } .game-card:nth-child(5) { animation-delay: 0.5s; }


        /* ========================================= */
        /* --- Crystal Panel Styles --- */
        /* ========================================= */
        .dashboard-panel {
            position: absolute; top: 48%; left: 50%; height: 72%; width: 90%;
            background: var(--panel-bg);
            backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border-radius: 20px; z-index: 150; 
            display: flex; flex-direction: column; opacity: 0; pointer-events: none;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translate(-50%, -50%) scale(0.8);
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.9), 
                inset 0 0 30px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dashboard-panel.active { opacity: 1; pointer-events: all; transform: translate(-50%, -50%) scale(1); }

        .panel-header { height: 10%; display: flex; justify-content: space-around; align-items: center; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding: 0 10px; flex-shrink: 0; }
        .tab-item { color: #888; font-size: 1.6vh; font-weight: 700; cursor: pointer; position: relative; padding: 5px 0; transition: color 0.3s; }
        .tab-item.active { color: var(--text-gold); text-shadow: 0 0 10px rgba(244, 208, 111, 0.5); }
        .tab-item.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; background: var(--text-gold); box-shadow: 0 0 5px var(--text-gold); }
        .panel-footer { height: 14%; display: flex; justify-content: center; align-items: center; padding: 0 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); flex-shrink: 0; }
        .close-gold-btn { background: linear-gradient(180deg, #ffeebb 0%, #aa8741 50%, #75551d 100%); border: 1px solid #ffd700; border-radius: 20px; padding: 8px 45px; color: #422100; font-weight: 800; font-size: 1.8vh; letter-spacing: 1px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); cursor: pointer; transition: transform 0.1s; }
        .close-gold-btn:active { transform: scale(0.95); filter: brightness(1.1); }
        .panel-content { flex: 1; padding: 15px 10px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #aa8741 rgba(255, 255, 255, 0.1); }
        .panel-content::-webkit-scrollbar { width: 5px; } .panel-content::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; } .panel-content::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #aa8741, #cbbd83); border-radius: 10px; }

        /* Slots Grid */
        .slots-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; width: 100%; }
        .slot-icon { width: 100%; aspect-ratio: 2/1; border-radius: 8px; overflow: hidden; background: #000; position: relative; border: 1px solid rgba(255, 255, 255, 0.15); transition: transform 0.1s; }
        .slot-icon:active { transform: scale(0.9); border-color: var(--text-gold); }
        .slot-thumb { width: 100%; height: 100%; object-fit: cover; }

        /* Rewards Styles */
        .rewards-tabs { height: 12%; display: flex; align-items: center; justify-content: center; gap: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding: 0 10px; }
        .r-tab-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: #aaa; padding: 6px 16px; border-radius: 20px; font-size: 1.5vh; font-weight: 700; cursor: pointer; transition: all 0.2s; }
        .r-tab-btn.active { background: linear-gradient(180deg, #ffeebb 0%, #aa8741 100%); border-color: #ffd700; color: #422100; box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        .rewards-content-area { flex: 1; padding: 15px; overflow-y: auto; position: relative; }
        .r-view { display: none; height: 100%; flex-direction: column; animation: fadeIn 0.3s; }
        .r-view.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Daily/Mail/Gift Styles */
        .daily-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; height: 100%; align-content: start; }
        .day-box { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; aspect-ratio: 1/1.1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .day-box.day-7 { grid-column: 1 / -1; aspect-ratio: 3/1; background: linear-gradient(45deg, rgba(255,215,0,0.1), rgba(255,0,0,0.1)); border: 1px solid rgba(255,215,0,0.3); }
        .day-num { font-size: 1.2vh; color: #888; margin-bottom: 5px; }
        .day-coin-img { width: 50%; height: auto; margin-bottom: 5px; filter: drop-shadow(0 0 5px rgba(255,215,0,0.5)); }
        .day-val { font-size: 1.6vh; color: #fff; font-weight: 800; }
        .day-box.claimed { opacity: 0.5; filter: grayscale(1); }
        .day-box.claimed::after { content: "‚úî"; position: absolute; font-size: 3vh; color: #00ff00; text-shadow: 0 0 5px #000; font-weight: 900; }
        .day-box.active { border-color: #ffd700; background: rgba(255, 215, 0, 0.1); cursor: pointer; animation: pulseBox 1.5s infinite; }
        .day-box.active .day-val { color: #ffd700; text-shadow: 0 0 5px orange; }
        @keyframes pulseBox { 0% { transform: scale(1); } 50% { transform: scale(1.02); box-shadow: 0 0 15px rgba(255,215,0,0.3); } 100% { transform: scale(1); } }
        .mail-list { display: flex; flex-direction: column; gap: 8px; }
        .mail-item { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 10px; cursor: pointer; transition: background 0.2s; border-left: 3px solid transparent; }
        .mail-item:active { background: rgba(255,255,255,0.1); }
        .mail-item.unread { border-left: 3px solid #ff4500; background: rgba(255, 69, 0, 0.1); }
        .mail-icon { font-size: 2.5vh; }
        .mail-info { flex: 1; }
        .mail-title { color: #fff; font-size: 1.6vh; font-weight: bold; margin-bottom: 2px; }
        .mail-date { color: #666; font-size: 1.2vh; }
        .mail-status { font-size: 1.2vh; color: #aaa; }
        .gift-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; gap: 20px; }
        .gift-input-group { width: 100%; }
        .gift-label { color: #aaa; font-size: 1.4vh; margin-bottom: 5px; display: block; text-align: left; padding-left: 10px; }
        .gift-input { width: 100%; padding: 12px; border-radius: 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: #fff; font-size: 1.6vh; outline: none; }
        .gift-input:focus { border-color: #ffd700; }
        .send-btn { width: 100%; padding: 12px; border-radius: 10px; background: linear-gradient(90deg, #ff4500, #ff8c00); color: white; font-weight: bold; border: none; font-size: 1.8vh; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 69, 0, 0.4); }
        .send-btn:active { transform: scale(0.95); filter: brightness(0.8); }

        /* --- Profile Styles --- */
        .profile-header { padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 10px; background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 100%); border-radius: 20px 20px 0 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .p-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); }
        .p-info { text-align: center; }
        .p-name { color: #fff; font-size: 2.2vh; font-weight: 800; }
        .p-id { color: #888; font-size: 1.4vh; margin-top: 2px; }
        .vip-container { width: 100%; margin-top: 10px; }
        .vip-labels { display: flex; justify-content: space-between; font-size: 1.2vh; color: #ffd700; font-weight: bold; margin-bottom: 4px; }
        .vip-track { width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden; }
        .vip-fill { width: 35%; height: 100%; background: linear-gradient(90deg, #ffd700, #ff8c00); box-shadow: 0 0 10px #ffd700; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px; }
        .stat-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-label { color: #aaa; font-size: 1.4vh; margin-bottom: 5px; }
        .stat-val { color: #fff; font-size: 2vh; font-weight: bold; }
        .settings-list { padding: 0 20px; display: flex; flex-direction: column; gap: 10px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: 12px 15px; border-radius: 10px; }
        .setting-label { color: #fff; font-size: 1.6vh; }
        .logout-btn { margin: 20px; padding: 12px; border-radius: 10px; background: rgba(255, 69, 0, 0.2); border: 1px solid rgba(255, 69, 0, 0.5); color: #ff4500; font-weight: bold; text-align: center; cursor: pointer; transition: all 0.2s; }
        .logout-btn:active { background: rgba(255, 69, 0, 0.4); transform: scale(0.98); }

        /* --- Rankings Panel Styles --- */
        .rank-list { padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .rank-item { display: flex; align-items: center; background: rgba(255, 255, 255, 0.05); padding: 12px 15px; border-radius: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .rank-num { width: 30px; font-size: 2vh; font-weight: 900; color: #888; text-align: center; }
        .rank-item:nth-child(1) .rank-num { color: #ffd700; text-shadow: 0 0 10px #ffd700; font-size: 2.5vh; }
        .rank-item:nth-child(2) .rank-num { color: #c0c0c0; text-shadow: 0 0 5px #c0c0c0; }
        .rank-item:nth-child(3) .rank-num { color: #cd7f32; text-shadow: 0 0 5px #cd7f32; }
        .rank-avatar { width: 35px; height: 35px; border-radius: 50%; margin: 0 15px; border: 1px solid #555; object-fit: cover; }
        .rank-info { flex: 1; }
        .rank-name { color: #fff; font-weight: bold; font-size: 1.6vh; }
        .rank-vip { font-size: 1.2vh; background: #333; color: #ffd700; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 2px; }
        .rank-val { color: #00ff00; font-weight: bold; font-size: 1.6vh; }

        /* --- Crystal Wallet Modal --- */
        #wallet-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        #wallet-modal.active { opacity: 1; pointer-events: all; }
        .wallet-box { 
            width: 85%; 
            background: linear-gradient(145deg, rgba(42, 45, 62, 0.8), rgba(26, 28, 41, 0.9)); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 20px; padding: 20px; position: relative; 
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 40px rgba(0,0,0,0.8), inset 0 0 20px rgba(255,255,255,0.05);
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        #wallet-modal.active .wallet-box { transform: scale(1); }
        .w-header { text-align: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .w-title { color: #ffd700; font-size: 2.2vh; font-weight: 800; letter-spacing: 1px; }
        .w-balance { color: #fff; font-size: 1.6vh; margin-top: 5px; opacity: 0.8; }
        .w-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .w-option { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,215,0,0.1); border-radius: 10px; padding: 15px 10px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden; }
        .w-option.active { border-color: #ffd700; background: rgba(255,215,0,0.1); }
        .w-option:active { transform: scale(0.95); }
        .w-coins { color: #ffd700; font-size: 2vh; font-weight: bold; display: block; margin-bottom: 5px; }
        .w-price { color: #fff; font-size: 1.4vh; background: #ff4500; padding: 2px 8px; border-radius: 4px; display: inline-block; }
        .w-actions { display: flex; gap: 10px; }
        .w-btn { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-size: 1.6vh; }
        .w-btn.cancel { background: rgba(255,255,255,0.1); color: #aaa; }
        .w-btn.confirm { background: linear-gradient(90deg, #ffd700, #ff8c00); color: #422100; box-shadow: 0 0 10px rgba(255,215,0,0.4); }
        .w-btn:active { transform: scale(0.95); }

        /* --- Overlay & Game Container --- */
        #transition-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; opacity: 0; pointer-events: none; transition: opacity 0.5s ease-in-out; }
        #transition-overlay.active { opacity: 1; pointer-events: all; }
        
        #game-container { position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100vw; height: 100vh; z-index: 20000; background: #000; display: none; }
        #game-frame { width: 100%; height: 100%; border: none; display: block; }
        
        #close-game-btn { position: absolute; top: 40px; left: 20px; z-index: 20001; display: none !important; }
        
        /* --- [Êñ∞Â¢û] Auth Modal Styles --- */
        #auth-modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); /* ËÉåÊôØÈªë‰∏ÄÈªûÔºåÂ∞àÊ≥®ÁôªÂÖ• */
            z-index: 30000; /* ÊúÄ‰∏äÂ±§ÔºåÊØîÈÅäÊà≤Â±§ÈÇÑÈ´ò */
            display: flex; justify-content: center; align-items: center; 
            opacity: 0; pointer-events: none; transition: opacity 0.3s; 
        }
        #auth-modal.active { opacity: 1; pointer-events: all; }

    </style>
</head>
<body>

    <div class="app-container">
        
        <canvas id="lobby-bg-canvas"></canvas>

        <header class="top-bar gradient-border-box">
            <div class="user-section">
                <img src="player.png" class="avatar-img" alt="User">
                <span class="vip-text">VIP.1</span>
            </div>
            <div class="coin-bar">
                <img src="gold.png" class="gold-icon" alt="G">
                <div class="center-group">
                    <span class="coin-number">---</span>
                    <img src="coins.png" class="coins-text-img" alt="COINS">
                </div>
                <img src="+.png" class="plus-btn clickable-btn" alt="+">
            </div>
            <img src="option.png" class="menu-btn clickable-btn" alt="Menu">
        </header>

        <div id="ghost-ticker">
            <div class="ticker-content" id="ticker-text"></div>
        </div>

        <main class="main-scroll-area">
            <div class="game-card" id="game-dragon"><img src="game001.png" class="game-img" alt="Dragon"></div>
            <div class="game-card"><img src="game002.png" class="game-img" alt="Game 2"></div>
            <div class="game-card"><img src="game003.png" class="game-img" alt="Game 3"></div>
            <div class="game-card"><img src="game004.png" class="game-img" alt="Game 4"></div>
            <div class="game-card"><img src="game001.png" class="game-img" alt="Game 5"></div>
            <div style="height: 5vh;"></div>
        </main>

        <div id="slots-panel" class="dashboard-panel gradient-border-box">
            <div class="panel-header">
                <div class="tab-item active">ÂÖ®ÈÉ®</div>
                <div class="tab-item">ÁÜ±ÈñÄ üî•</div>
                <div class="tab-item">Êñ∞ÈÅäÊà≤ üíé</div>
                <div class="tab-item">ÊúÄÊÑõ ‚ù§Ô∏è</div>
            </div>
            <div class="panel-content">
                <div class="slots-grid">
                    <div class="slot-icon"><img src="game001.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game002.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game003.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game004.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game001.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game002.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game003.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game004.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game001.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game002.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game003.png" class="slot-thumb"></div>
                    <div class="slot-icon"><img src="game004.png" class="slot-thumb"></div>
                </div>
            </div>
            <div class="panel-footer">
                <div class="close-gold-btn" id="close-slots-btn">CLOSE</div>
            </div>
        </div>

        <div id="rewards-panel" class="dashboard-panel gradient-border-box">
            <div class="rewards-tabs">
                <div class="r-tab-btn active" onclick="switchRewardTab('daily')">ÊØèÊó•Á∞ΩÂà∞</div>
                <div class="r-tab-btn" onclick="switchRewardTab('mail')">‰ø°ÁÆ± (2)</div>
                <div class="r-tab-btn" onclick="switchRewardTab('gift')">ÈÄÅÁ¶Æ</div>
            </div>

            <div class="rewards-content">
                
                <div id="view-daily" class="r-view active">
                    <div class="daily-grid">
                        <div class="day-box claimed">
                            <span class="day-num">Day 1</span>
                            <img src="gold.png" class="day-coin-img">
                            <span class="day-val">1000</span>
                        </div>
                        <div class="day-box active" onclick="claimDaily(this, 2000)">
                            <span class="day-num">Day 2</span>
                            <img src="gold.png" class="day-coin-img">
                            <span class="day-val">2,000</span>
                        </div>
                        <div class="day-box"><span class="day-num">Day 3</span><img src="gold.png" class="day-coin-img" style="opacity:0.5"><span class="day-val" style="color:#666">3,000</span></div>
                        <div class="day-box"><span class="day-num">Day 4</span><img src="gold.png" class="day-coin-img" style="opacity:0.5"><span class="day-val" style="color:#666">4,000</span></div>
                        <div class="day-box"><span class="day-num">Day 5</span><img src="gold.png" class="day-coin-img" style="opacity:0.5"><span class="day-val" style="color:#666">5,000</span></div>
                        <div class="day-box"><span class="day-num">Day 6</span><img src="gold.png" class="day-coin-img" style="opacity:0.5"><span class="day-val" style="color:#666">8,000</span></div>
                        <div class="day-box day-7">
                            <span class="day-num">Day 7 - MEGA BOX</span>
                            <img src="events.png" class="day-coin-img" style="width: 15%; opacity:0.5">
                            <span class="day-val" style="color:#666">20,000</span>
                        </div>
                    </div>
                </div>

                <div id="view-mail" class="r-view">
                    <div class="mail-list">
                        <div class="mail-item unread" onclick="readMail(this)">
                            <div class="mail-icon">üéÅ</div>
                            <div class="mail-info">
                                <div class="mail-title">Á∂≠Ë≠∑Ë£úÂÑüÁçéÂãµ</div>
                                <div class="mail-date">2025/12/30 14:00</div>
                            </div>
                            <div class="mail-status">Êú™ËÆÄ</div>
                        </div>
                        <div class="mail-item unread" onclick="readMail(this)">
                            <div class="mail-icon">üî•</div>
                            <div class="mail-info">
                                <div class="mail-title">ÁÅ´ÈæçÁ•ïÂØ∂ - Êñ∞Ê©ü‰∏äÁ∑ö!</div>
                                <div class="mail-date">2025/12/29 09:00</div>
                            </div>
                            <div class="mail-status">Êú™ËÆÄ</div>
                        </div>
                        <div class="mail-item">
                            <div class="mail-icon">‚úâÔ∏è</div>
                            <div class="mail-info">
                                <div class="mail-title">Ê≠°ËøéÂä†ÂÖ• Casino Lobby</div>
                                <div class="mail-date">2025/12/01 00:00</div>
                            </div>
                            <div class="mail-status">Â∑≤ËÆÄ</div>
                        </div>
                    </div>
                </div>

                <div id="view-gift" class="r-view">
                    <div class="gift-container">
                        <img src="player.png" style="width: 80px; border-radius:50%; border:2px solid #ffd700;">
                        <div style="color:#fff; font-weight:bold;">Ë¥àÈÄÅÈáëÂπ£Áµ¶Â•ΩÂèã</div>
                        
                        <div class="gift-input-group">
                            <span class="gift-label">Â•ΩÂèã ID / E-mail</span>
                            <input type="text" class="gift-input" placeholder="Ëº∏ÂÖ•Áé©ÂÆ∂ ID...">
                        </div>
                        
                        <div class="gift-input-group">
                            <span class="gift-label">Ë¥àÈÄÅÈáëÈ°ç</span>
                            <select class="gift-input">
                                <option>1,000 ÈáëÂπ£</option>
                                <option>5,000 ÈáëÂπ£</option>
                                <option>10,000 ÈáëÂπ£</option>
                            </select>
                        </div>

                        <button class="send-btn" onclick="alert('ÁôºÈÄÅÊàêÂäüÔºÅÊÇ®ÁöÑÂ•ΩÂèãÂ∞áÊî∂Âà∞ÈáëÂπ£„ÄÇ')">Á¢∫Ë™çÁôºÈÄÅ</button>
                    </div>
                </div>

            </div>

            <div class="panel-footer">
                <div class="close-gold-btn" id="close-rewards-btn">CLOSE</div>
            </div>
        </div>

        <div id="profile-panel" class="dashboard-panel gradient-border-box">
            <div class="profile-header">
                <img src="player.png" class="p-avatar">
                <div class="p-info"><div class="p-name">Loading...</div><div class="p-id">ID: ---</div></div>
                <div class="vip-container">
                    <div class="vip-labels"><span>VIP.1</span><span>VIP.2</span></div>
                    <div class="vip-track"><div class="vip-fill"></div></div>
                </div>
            </div>
            <div style="flex: 1; overflow-y: auto;">
                <div class="stats-grid">
                    <div class="stat-box"><div class="stat-label">Á∏ΩË¥èÂàÜ</div><div class="stat-val" style="color: #00ff00;">98.5M</div></div>
                    <div class="stat-box"><div class="stat-label">ÊúÄÈ´òÂÄçÁéá</div><div class="stat-val" style="color: #ffd700;">x5000</div></div>
                </div>
                <div class="settings-list">
                    <div class="setting-item"><span class="setting-label">ËÉåÊôØÈü≥Ê®Ç</span><div style="color: #00ff00; font-weight:bold;">ON</div></div>
                    <div class="setting-item"><span class="setting-label">ÈÅäÊà≤Èü≥Êïà</span><div style="color: #00ff00; font-weight:bold;">ON</div></div>
                    <div class="setting-item"><span class="setting-label">Êé®Êí≠ÈÄöÁü•</span><div style="color: #666;">OFF</div></div>
                </div>
                <div class="logout-btn" onclick="logout()">ÁôªÂá∫Â∏≥Ëôü</div>
            </div>
            <div class="panel-footer">
                <div class="close-gold-btn" id="close-profile-btn">CLOSE</div>
            </div>
        </div>

        <div id="rankings-panel" class="dashboard-panel gradient-border-box">
            <div class="profile-header">
                <img src="Rankings.png" style="width: 60px; height: auto;">
                <h2 style="color: #ffd700; margin: 5px 0 0 0;">ÂØåË±™ÊéíË°åÊ¶ú</h2>
                <div style="color:#888; font-size:1.2vh;">Top Wealthy Players</div>
            </div>
            <div class="panel-content">
                <div class="rank-list" id="rank-list-content">
                    <div style="text-align:center; color:#888;">ËºâÂÖ•‰∏≠...</div>
                </div>
            </div>
            <div class="panel-footer">
                <div class="close-gold-btn" id="close-rankings-btn">CLOSE</div>
            </div>
        </div>

        <div id="wallet-modal">
            <div class="wallet-box">
                <div class="w-header"><div class="w-title">ÂÑ≤ÂÄº‰∏≠ÂøÉ</div><div class="w-balance">Áï∂ÂâçÈ§òÈ°ç: ---</div></div>
                <div class="w-grid">
                    <div class="w-option" onclick="selectRecharge(this, 100000)"><span class="w-coins">100,000</span><span class="w-price">$0.99</span></div>
                    <div class="w-option active" onclick="selectRecharge(this, 500000)"><span class="w-coins">500,000</span><span class="w-price">$4.99</span></div>
                    <div class="w-option" onclick="selectRecharge(this, 1200000)"><span class="w-coins">1,200,000</span><span class="w-price">$9.99</span></div>
                    <div class="w-option" onclick="selectRecharge(this, 6500000)"><span class="w-coins">6,500,000</span><span class="w-price">$49.99</span></div>
                </div>
                <div class="w-actions">
                    <button class="w-btn cancel" id="close-wallet-btn">ÂèñÊ∂à</button>
                    <button class="w-btn confirm" onclick="confirmRecharge()">Á´ãÂç≥ÊîØ‰ªò</button>
                </div>
            </div>
        </div>

        <div id="auth-modal" class="active"> <div class="wallet-box" style="width: 40vh; max-width: 90%;">
                <div class="w-header">
                    <div class="w-title" id="auth-title">ÁôªÂÖ• / Ë®ªÂÜä</div>
                    <div class="w-balance" style="color:#aaa;">Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÊö±Á®±ËàáÂØÜÁ¢º</div>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <span class="gift-label">Â∏≥Ëôü (Êö±Á®±)</span>
                        <input type="text" id="auth-name" class="gift-input" placeholder="Ë´ãËº∏ÂÖ•Êö±Á®± (‰∏çÂèØÈáçË§á)" style="background: rgba(0,0,0,0.5);">
                    </div>
                    <div>
                        <span class="gift-label">ÂØÜÁ¢º</span>
                        <input type="text" id="auth-pass" class="gift-input" placeholder="Ë´ãË®≠ÂÆöÂØÜÁ¢º (Ëá™Ë®Ç)" style="background: rgba(0,0,0,0.5);">
                    </div>
                </div>

                <div class="w-actions">
                    <button class="w-btn cancel" style="background: #444; color: #fff;" onclick="doLogin()">ÁôªÂÖ•</button>
                    <button class="w-btn confirm" onclick="doRegister()">Ë®ªÂÜäÊñ∞Â∏≥Ëôü</button>
                </div>
            </div>
        </div>

        <nav class="bottom-nav gradient-border-box">
            <div class="nav-item active" id="nav-home">
                <img src="home.png" class="nav-icon" alt="Home">
                <span class="nav-label">Home</span>
            </div>
            <div class="nav-item" id="nav-slots">
                <img src="games.png" class="nav-icon" alt="Slots">
                <span class="nav-label">Slots</span>
            </div>
            <div class="nav-item" id="nav-rankings">
                <img src="Rankings.png" class="nav-icon" alt="Rankings">
                <span class="nav-label">Rank</span>
            </div>
            <div class="nav-item" id="nav-rewards">
                <img src="events.png" class="nav-icon" alt="Rewards">
                <span class="nav-label">Rewards</span>
            </div>
            <div class="nav-item" id="nav-profile">
                <img src="profile.png" class="nav-icon" alt="Profile">
                <span class="nav-label">Profile</span>
            </div>
        </nav>
    </div>

    <div id="transition-overlay"></div>
    <div id="game-container">
        <button id="close-game-btn">‚úï</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // --- 1. Firebase Configuration & Initialization ---
        const firebaseConfig = {
            apiKey: "AIzaSyA13JH6n_YRY2Rtiuq2u3iN4mEe5cQL8Bo",
            authDomain: "casino-lobby-123f5.firebaseapp.com",
            projectId: "casino-lobby-123f5",
            storageBucket: "casino-lobby-123f5.firebasestorage.app",
            messagingSenderId: "433397567788",
            appId: "1:433397567788:web:197a552bba01b186dedc89"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // --- 2. User Logic with Firebase (ÂÖ®Êñ∞Â∏≥ËôüÂØÜÁ¢ºÁâà) ---
        let currentUser = null;
        let myUserId = localStorage.getItem('casino_firebase_uid');

        // Á≥ªÁµ±ÂïüÂãïÊôÇÊ™¢Êü•
        function initUser() {
            const authModal = document.getElementById('auth-modal');
            
            // Â¶ÇÊûúÊú¨Ê©üÂ∑≤Á∂ìÊúâÁ¥ÄÈåÑ IDÔºåÂòóË©¶Ëá™ÂãïÁôªÂÖ•
            if (myUserId) {
                db.ref('players/' + myUserId).once('value', (snapshot) => {
                    const data = snapshot.val();
                    
                    // ‚òÖ ‰øÆÊîπÈóúÈçµÔºöÂ§öÂä†‰∫Ü "&& data.password"
                    // Âè™ÊúâÁï∂Ë≥áÊñôÂ≠òÂú®Ôºå‰∏î„ÄåÊúâÂØÜÁ¢º„Äç(Ë°®Á§∫ÊòØÊñ∞ÁâàË®ªÂÜäÂ∏≥Ëôü) ÊôÇÔºåÊâçËá™ÂãïÁôªÂÖ•
                    if (data && data.password) {
                        // ÊúâË≥áÊñô‰∏îÊúâÂØÜÁ¢º -> Ëá™ÂãïÁôªÂÖ•
                        currentUser = data;
                        authModal.classList.remove('active'); // Èö±ËóèÁôªÂÖ•Ê°Ü
                        updateUserUI();
                        startTickerListener(); 
                        listenUserData(); 
                    } else {
                        // ÊÉÖÊ≥Å A: ID ÁÑ°Êïà (Ë¢´ÂæåÂè∞Âà™Èô§)
                        // ÊÉÖÊ≥Å B: ÊòØËàäÁâàÈÅäÂÆ¢Â∏≥Ëôü (ÊúâË≥áÊñô‰ΩÜÊ≤íÂØÜÁ¢º)
                        // -> Ê∏ÖÈô§ËàäÁ¥ÄÈåÑÔºå‰øùÊåÅÁôªÂÖ•Ê°ÜÈ°ØÁ§∫ÔºåËÆìÁé©ÂÆ∂ÈáçÊñ∞Ë®ªÂÜä
                        localStorage.removeItem('casino_firebase_uid');
                        authModal.classList.add('active');
                    }
                });
            } else {
                // Ê≤íË≥áÊñôÔºåÈ°ØÁ§∫ÁôªÂÖ•Ê°Ü
                authModal.classList.add('active');
            }
        }

        // ÁôªÂÖ•ÂäüËÉΩ
        window.doLogin = function() {
            const name = document.getElementById('auth-name').value.trim();
            const pass = document.getElementById('auth-pass').value.trim();

            if(!name || !pass) { alert("Ë´ãËº∏ÂÖ•Â∏≥ËôüËàáÂØÜÁ¢º"); return; }

            // ‚òÖ Êü•Ë©¢Ë≥áÊñôÂ∫´ÔºöÊâæÂêçÂ≠ó‰∏ÄÊ®£ÁöÑ
            db.ref('players').orderByChild('name').equalTo(name).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    // ÊâæÂà∞Ë©≤ÂêçÂ≠óÔºåÊ™¢Êü•ÂØÜÁ¢º
                    let foundUser = false;
                    snapshot.forEach(child => {
                        const userData = child.val();
                        if (userData.password === pass) {
                            // ÂØÜÁ¢ºÊ≠£Á¢∫
                            foundUser = true;
                            myUserId = child.key; // ÂèñÂæóË©≤Áî®Êà∂ÁöÑ‰∫ÇÁ¢º ID
                            localStorage.setItem('casino_firebase_uid', myUserId);
                            currentUser = userData;
                            
                            document.getElementById('auth-modal').classList.remove('active');
                            updateUserUI();
                            startTickerListener();
                            listenUserData();
                            alert("Ê≠°ËøéÂõû‰æÜÔºå" + userData.name + "ÔºÅ");
                        }
                    });

                    if (!foundUser) {
                        alert("ÂØÜÁ¢ºÈåØË™§ÔºÅ(ÊàñÊòØÊÇ®ÂèØ‰ª•ËÅØÁπ´ÁÆ°ÁêÜÂì°Êü•Ë©¢)");
                    }
                } else {
                    alert("Êâæ‰∏çÂà∞Ê≠§Â∏≥ËôüÔºåË´ãÂÖàË®ªÂÜä„ÄÇ");
                }
            });
        }

        // Ë®ªÂÜäÂäüËÉΩ
        window.doRegister = function() {
            const name = document.getElementById('auth-name').value.trim();
            const pass = document.getElementById('auth-pass').value.trim();

            if(!name || !pass) { alert("Ë´ãËº∏ÂÖ•Â∏≥ËôüËàáÂØÜÁ¢º"); return; }

            // ‚òÖ Ê≠•È©ü 1: Ê™¢Êü•ÂêçÂ≠óÊòØÂê¶ÈáçË§á
            db.ref('players').orderByChild('name').equalTo(name).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    alert("ÈÄôÂÄãÊö±Á®±Â∑≤Á∂ìÊúâ‰∫∫‰ΩøÁî®‰∫ÜÔºåË´ãÊèõ‰∏ÄÂÄãÔºÅ");
                    return;
                }

                // ‚òÖ Ê≠•È©ü 2: ÂêçÂ≠óÊ≤íÈáçË§áÔºåÂª∫Á´ãÊñ∞Â∏≥Ëôü
                const newId = 'user_' + Date.now(); // Áî®ÊôÇÈñìÊà≥Ë®òÁï∂ ID
                const newUser = {
                    name: name,
                    password: pass, // ‚òÖ ÈÄôË£°ÂÑ≤Â≠òÂØÜÁ¢º (ÂæåÂè∞ÂèØË¶ã)
                    balance: 10000,
                    vip: 1,
                    joinedAt: Date.now()
                };

                db.ref('players/' + newId).set(newUser, (error) => {
                    if (error) {
                        alert("Ë®ªÂÜäÂ§±ÊïóÔºö" + error.message);
                    } else {
                        alert("Ë®ªÂÜäÊàêÂäüÔºÅÁç≤ÂæóÈ´îÈ©óÈáë 10,000");
                        myUserId = newId;
                        localStorage.setItem('casino_firebase_uid', myUserId);
                        currentUser = newUser;
                        
                        document.getElementById('auth-modal').classList.remove('active');
                        updateUserUI();
                        startTickerListener();
                        listenUserData();
                    }
                });
            });
        }

        // ÂØ¶ÊôÇÁõ£ËÅΩÊï∏ÊìöËÆäÂãï (È§òÈ°çÊõ¥Êñ∞Áî®)
        function listenUserData() {
            if(!myUserId) return;
            db.ref('players/' + myUserId).on('value', (snapshot) => {
                const data = snapshot.val();
                if(data) {
                    currentUser = data;
                    updateUserUI();
                }
            });
        }

        // ÂïüÂãïË∑ëÈ¶¨ÁáàÁõ£ËÅΩ (Âæû initUser ÊãÜÂá∫‰æÜ)
        function startTickerListener() {
            db.ref('system/ticker').on('value', (snapshot) => {
                const msg = snapshot.val();
                if(msg) {
                    showGhostTicker(msg);
                    const gameFrame = document.getElementById('game-frame');
                    if (gameFrame && gameFrame.contentWindow) {
                        gameFrame.contentWindow.postMessage({ type: 'tickerMessage', msg: msg }, '*');
                    }
                }
            });
        }

        function updateUserUI() {
            if(!currentUser) return;
            document.querySelector('.coin-number').innerText = currentUser.balance.toLocaleString('en-US', {minimumFractionDigits: 2});
            document.querySelector('.vip-text').innerText = "VIP." + currentUser.vip;
            document.querySelector('.p-name').innerText = currentUser.name;
            document.querySelector('.p-id').innerText = "ID: " + currentUser.name; // È°ØÁ§∫ÂêçÂ≠óÂ∞±Â•Ω
            document.querySelector('.w-balance').innerText = "Áï∂ÂâçÈ§òÈ°ç: " + currentUser.balance.toLocaleString('en-US', {minimumFractionDigits: 2});
        }

        function updateUserBalance(amount) {
            db.ref('players/' + myUserId + '/balance').transaction((currentBalance) => {
                return (currentBalance || 0) + amount;
            });
        }

        function logout() {
            if(confirm("Á¢∫ÂÆöË¶ÅÁôªÂá∫ÂóéÔºü")) {
                localStorage.removeItem('casino_firebase_uid');
                location.reload(); 
            }
        }

        // --- 3. Navigation & Panels ---
        const navItems = document.querySelectorAll('.nav-item');
        const mainScroll = document.querySelector('.main-scroll-area');
        
        const slotsPanel = document.getElementById('slots-panel');
        const rewardsPanel = document.getElementById('rewards-panel');
        const profilePanel = document.getElementById('profile-panel');
        const rankingsPanel = document.getElementById('rankings-panel'); 
        
        const closeSlotsBtn = document.getElementById('close-slots-btn');
        const closeRewardsBtn = document.getElementById('close-rewards-btn');
        const closeProfileBtn = document.getElementById('close-profile-btn');
        const closeRankingsBtn = document.getElementById('close-rankings-btn'); 
        
        const navHome = document.getElementById('nav-home');
        
        const walletModal = document.getElementById('wallet-modal');
        const closeWalletBtn = document.getElementById('close-wallet-btn');
        const plusBtn = document.querySelector('.plus-btn');

        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                if (item.id === 'nav-slots') openPanel(slotsPanel);
                else if (item.id === 'nav-rewards') openPanel(rewardsPanel);
                else if (item.id === 'nav-profile') openPanel(profilePanel);
                else if (item.id === 'nav-rankings') openRankingsPanel();
                else closeAllPanels();
            });
        });

        function openPanel(targetPanel) {
            mainScroll.classList.add('hidden');
            [slotsPanel, rewardsPanel, profilePanel, rankingsPanel].forEach(p => {
                if(p !== targetPanel) p.classList.remove('active');
            });
            setTimeout(() => { targetPanel.classList.add('active'); }, 200);
        }

        function closeAllPanels() {
            [slotsPanel, rewardsPanel, profilePanel, rankingsPanel].forEach(p => p.classList.remove('active'));
            setTimeout(() => { mainScroll.classList.remove('hidden'); }, 200);
            navItems.forEach(i => i.classList.remove('active'));
            navHome.classList.add('active');
        }

        closeSlotsBtn.addEventListener('click', closeAllPanels);
        closeRewardsBtn.addEventListener('click', closeAllPanels);
        closeProfileBtn.addEventListener('click', closeAllPanels);
        closeRankingsBtn.addEventListener('click', closeAllPanels); 

        // --- Rankings Logic ---
        function openRankingsPanel() {
            openPanel(rankingsPanel);
            const listDiv = document.getElementById('rank-list-content');
            listDiv.innerHTML = '<div style="text-align:center; color:#888;">Ê≠£Âú®ËÆÄÂèñÊï∏Êìö...</div>';

            db.ref('players').orderByChild('balance').limitToLast(10).once('value', (snapshot) => {
                listDiv.innerHTML = '';
                const players = [];
                snapshot.forEach(child => {
                    players.push(child.val());
                });
                players.reverse();

                players.forEach((p, index) => {
                    const item = document.createElement('div');
                    item.className = 'rank-item';
                    item.innerHTML = `
                        <div class="rank-num">${index + 1}</div>
                        <img src="player.png" class="rank-avatar">
                        <div class="rank-info">
                            <div class="rank-name">${p.name}</div>
                            <div class="rank-vip">VIP.${p.vip || 1}</div>
                        </div>
                        <div class="rank-val">${(p.balance || 0).toLocaleString()}</div>
                    `;
                    listDiv.appendChild(item);
                });
            });
        }

        // --- Ghost Ticker Logic ---
        function showGhostTicker(msg) {
            const ticker = document.getElementById('ghost-ticker');
            const text = document.getElementById('ticker-text');
            text.innerText = msg;
            text.style.animation = 'none'; 
            ticker.offsetHeight; 
            ticker.classList.add('active');
            
            setTimeout(() => {
                text.style.animation = 'scrollText 10s linear forwards';
            }, 100);

            setTimeout(() => {
                ticker.classList.remove('active');
            }, 10000);
        }

        // --- 4. Feature Logic ---
        const tabs = document.querySelectorAll('.tab-item');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            });
        });

        window.switchRewardTab = function(tabName) {
            const btns = document.querySelectorAll('.r-tab-btn');
            btns.forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            const views = document.querySelectorAll('.r-view');
            views.forEach(v => v.classList.remove('active'));
            document.getElementById(`view-${tabName}`).classList.add('active');
        }

        window.claimDaily = function(element, amount) {
            if(element.classList.contains('claimed')) return;
            element.classList.remove('active'); element.classList.add('claimed');
            alert(`üéâ Á∞ΩÂà∞ÊàêÂäüÔºÅÁç≤Âæó ${amount} ÈáëÂπ£ÔºÅ`);
            updateUserBalance(amount);
        }

        window.readMail = function(element) {
            if(element.classList.contains('unread')) {
                element.classList.remove('unread');
                element.querySelector('.mail-status').innerText = "Â∑≤ËÆÄ";
                const mailTab = document.querySelectorAll('.r-tab-btn')[1];
                mailTab.innerText = "‰ø°ÁÆ± (1)";
                alert("üì© È†òÂèñÈôÑ‰ª∂Ôºö500 ÈáëÂπ£");
                updateUserBalance(500);
            }
        }

        if (plusBtn) plusBtn.addEventListener('click', () => walletModal.classList.add('active'));
        if (closeWalletBtn) closeWalletBtn.addEventListener('click', () => walletModal.classList.remove('active'));

        window.selectRecharge = function(el, amount) {
            document.querySelectorAll('.w-option').forEach(opt => opt.classList.remove('active'));
            el.classList.add('active');
        }

        window.confirmRecharge = function() {
            walletModal.classList.remove('active');
            alert("Á≥ªÁµ±ÊèêÁ§∫ÔºöÊ≠£Âú®ÈÄ£Á∑öËá≥ÊîØ‰ªòÈñòÈÅì... (Ê®°Êì¨ÊàêÂäü)");
            updateUserBalance(500000); 
        }

        // --- 5. Game Integration (Cross-window) ---
        window.addEventListener('message', (event) => {
            if (event.data === 'closeGame') {
                const overlay = document.getElementById('transition-overlay');
                const gameContainer = document.getElementById('game-container');
                const dragonCard = document.getElementById('game-dragon');
                overlay.classList.add('active'); 
                setTimeout(() => {
                    gameContainer.style.display = 'none';
                    const iframe = document.getElementById('game-frame');
                    if(iframe) iframe.remove(); 
                    if(dragonCard) dragonCard.classList.remove('launching');
                    overlay.classList.remove('active'); 
                    if(myUserId) db.ref('players/' + myUserId).once('value');
                }, 500);
            }
            if (event.data.type === 'updateBalance') {
                db.ref('players/' + myUserId).update({
                    balance: event.data.value
                });
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            initUser(); 

            const dragonCard = document.getElementById('game-dragon');
            const overlay = document.getElementById('transition-overlay');
            const gameContainer = document.getElementById('game-container');
            const dragonUrl = "https://zendwucloud.github.io/Dragon-Treasure/"; 

            if (dragonCard) {
                dragonCard.addEventListener('click', function() {
                    if (this.classList.contains('launching')) return;
                    this.classList.add('launching');
                    setTimeout(() => {
                        overlay.classList.add('active'); 
                        setTimeout(() => {
                            let iframe = document.createElement('iframe');
                            iframe.id = "game-frame";
                            iframe.src = dragonUrl;
                            iframe.allow = "autoplay; fullscreen";
                            const oldFrame = document.getElementById('game-frame');
                            if(oldFrame) oldFrame.remove();
                            gameContainer.appendChild(iframe);
                            gameContainer.style.display = 'block';
                            
                            iframe.onload = () => { 
                                if(currentUser) {
                                    console.log("Â§ßÂª≥ÁôºÈÄÅÂàùÂßãÈ§òÈ°çÁµ¶ÈÅäÊà≤:", currentUser.balance);
                                    iframe.contentWindow.postMessage({
                                        type: 'initBalance', 
                                        value: currentUser.balance
                                    }, '*');
                                }
                                setTimeout(() => { overlay.classList.remove('active'); }, 300); 
                            };
                            
                            setTimeout(() => { if(overlay.classList.contains('active')) overlay.classList.remove('active'); }, 1500);
                        }, 500); 
                    }, 400);
                });
            }
        });

        // --- 6. Visuals ---
        (function initLobbyBackground() {
            const canvas = document.getElementById('lobby-bg-canvas');
            const container = document.querySelector('.app-container'); 
            if (!canvas || !container) return;
            const ctx = canvas.getContext('2d');
            let width, height, particles = [];
            const particleCount = 200;

            function resize() {
                width = container.clientWidth;
                height = container.clientHeight;
                canvas.width = width;
                canvas.height = height;
            }

            class Particle {
                constructor() { this.reset(true); }
                reset(isInit = false) {
                    let randX = (Math.random() + Math.random()) / 2;
                    this.x = randX * width;
                    this.y = isInit ? Math.random() * height : height + Math.random() * 50;
                    let speedFactor = 1 - Math.abs(randX - 0.5) * 5; 
                    this.vy = -(Math.random() * 1.2 + 0.5 + speedFactor * 0.8); 
                    this.vx = (Math.random() - 0.5) * 0.2; 
                    this.size = Math.random() * 2.5 + 0.5;
                    this.maxAlpha = Math.random() * 0.5 + 0.3; 
                    this.alpha = this.maxAlpha;
                    this.color = `244, 208, 111`; 
                }
                update() {
                    this.x += this.vx; this.y += this.vy; 
                    let fadeStartPoint = height * 0.5;
                    if (this.y < fadeStartPoint) {
                        this.alpha = (this.y / fadeStartPoint) * this.maxAlpha;
                        if (this.alpha < 0) this.alpha = 0;
                    } else { this.alpha = this.maxAlpha; }
                    if (this.y < -10) this.reset(false);
                }
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${this.color}, ${this.alpha})`;
                    if (this.alpha > 0.01) { ctx.shadowBlur = 10; ctx.shadowColor = `rgba(${this.color}, 0.8)`; }
                    ctx.fill(); ctx.shadowBlur = 0; 
                }
            }
            function initParticles() { particles = []; for (let i = 0; i < particleCount; i++) particles.push(new Particle()); }
            function drawPillar() {
                ctx.globalCompositeOperation = 'screen'; 
                let gradient = ctx.createRadialGradient(width/2, height/2, 1, width/2, height/2, width * 0.75);
                gradient.addColorStop(0, "rgba(244, 208, 111, 0.25)"); 
                gradient.addColorStop(0.5, "rgba(20, 20, 20, 0.1)");
                gradient.addColorStop(1, "rgba(0, 0, 0, 0)");
                ctx.fillStyle = gradient; ctx.fillRect(0, 0, width, height);
                let pillarWidth = width * 0.25;
                let linearGrad = ctx.createLinearGradient(width/2 - pillarWidth/2, 0, width/2 + pillarWidth/2, 0);
                linearGrad.addColorStop(0, "rgba(0,0,0,0)");
                linearGrad.addColorStop(0.5, "rgba(244, 208, 111, 0.12)");
                linearGrad.addColorStop(1, "rgba(0,0,0,0)");
                ctx.fillStyle = linearGrad; ctx.fillRect(width/2 - pillarWidth/2, 0, pillarWidth, height);
                ctx.globalCompositeOperation = 'source-over'; 
            }
            function animate() {
                ctx.clearRect(0, 0, width, height);
                drawPillar();
                particles.forEach(p => { p.update(); p.draw(); });
                requestAnimationFrame(animate);
            }
            window.addEventListener('resize', resize);
            resize(); initParticles(); animate();
        })();
    </script>
</body>
</html>